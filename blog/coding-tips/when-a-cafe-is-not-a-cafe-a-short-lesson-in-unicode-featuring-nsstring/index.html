<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>When A Café Is Not A Café – A Short Lesson In Unicode Featuring NSString — Tom Dalling</title>
    <link rel="stylesheet" href="/style.css">
    <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Merriweather+Sans:wght@700&amp;family=Merriweather:ital,wght@0,400;0,700;1,400;1,700&amp;family=Montserrat:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">

    <meta name="twitter:site" content="@tom_dalling">
    <meta name="twitter:creator" content="@tom_dalling">
    <link rel="alternate" type="application/rss+xml" title="Tom Dalling" href="https://www.tomdalling.com/blog/feed/">
  <link rel="canonical" href="https://www.tomdalling.com/blog/coding-tips/when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring/">
<meta property="og:title" content="When A Café Is Not A Café – A Short Lesson In Unicode Featuring NSString">
<meta property="og:url" content="https://www.tomdalling.com/blog/coding-tips/when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring/">
<meta name="twitter:card" content="summary">
</head>

  <body>

    <header class="tw-mb-6 tw-py-2 tw-bg-gray-100 tw-border-b tw-border-gray-200 tw-font-title">
      <nav class="tw-container tw-mx-auto max-w-screen-xl tw-space-x-8 tw-px-4">
        <a href="/" class="tw-text-xl tw-text-black">Tom Dalling</a>
        <a href="/blog/" class="tw-text-black">Blog</a>
      </nav>
    </header>

    <div class="tw-container tw-mx-auto tw-flex tw-flex-col lg:tw-flex-row">

      <main class="tw-flex-1 tw-min-w-0 tw-px-4"><article class="post post-single">

  <header>
    <h1><a href="/blog/coding-tips/when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring/">When A Café Is Not A Café – A Short Lesson In Unicode Featuring NSString</a></h1>
    <small class="meta">
      <span class="post-date">08 Mar, 2012</span>
      
      —
      Category: <a class="category" href="/blog/category/coding-tips/">Coding Tips</a>
      —
      Suggest changes <a class="post-github" href="https://github.com/tomdalling/tomdalling.com/tree/main/input/posts/2012-03-08_when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring.markdown">on GitHub</a>
    </small>
    
  </header>

  <div class="post-content body-text">
<p>Let’s start with two exotic strings (console output is in the code comments):</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NSString</span><span class="o">*</span> <span class="n">apples</span> <span class="o">=</span> <span class="n">NSGetFrenchWord</span><span class="p">();</span>
<span class="n">NSString</span><span class="o">*</span> <span class="n">oranges</span> <span class="o">=</span><span class="err"> </span><span class="n">NSGetFrenchWord</span><span class="p">();</span>

<span class="n">NSLog</span><span class="p">(</span><span class="s">@"apples == '%@'"</span><span class="p">,</span> <span class="n">apples</span><span class="p">);</span> 
<span class="c1">//apples == 'café'</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"oranges == '%@'"</span><span class="p">,</span> <span class="n">oranges</span><span class="p">);</span> 
<span class="c1">//oranges == 'café'</span>
</code></pre></div></div>

<p>They look identical, but looks can be deceiving.</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NSLog</span><span class="p">(</span><span class="s">@"isEqual? %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">apples</span> <span class="nf">isEqual</span><span class="p">:</span><span class="n">oranges</span><span class="p">]</span> <span class="p">?</span> <span class="s">@"YES"</span> <span class="p">:</span> <span class="s">@"NO"</span><span class="p">);</span>
<span class="c1">//isEqual? NO</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"[apples length] == %lu"</span><span class="p">,</span> <span class="p">[</span><span class="n">apples</span> <span class="nf">length</span><span class="p">]);</span>
<span class="c1">//[apples length] == 4</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"[oranges length] == %lu"</span><span class="p">,</span> <span class="p">[</span><span class="n">oranges</span> <span class="nf">length</span><span class="p">]);</span>
<span class="c1">//[oranges length] == 5</span>
</code></pre></div></div>

<!--more-->

<p>But if you were to sort them they should be the same, right?</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NSLog</span><span class="p">(</span><span class="s">@"NSOrderedSame? %@"</span><span class="p">,</span> <span class="p">[</span><span class="n">apples</span> <span class="nf">compare</span><span class="p">:</span><span class="n">oranges</span><span class="p">]</span> <span class="o">==</span> <span class="n">NSOrderedSame</span> <span class="p">?</span> <span class="s">@"YES"</span> <span class="p">:</span> <span class="s">@"NO"</span><span class="p">);</span>
<span class="c1">//NSOrderedSame? YES</span>
</code></pre></div></div>

<p>Well at least sorting works. Let’s inspect the strings one character at a time.</p>

<div class="language-objc highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">NSString</span><span class="o">*</span> <span class="nf">CodePoints</span><span class="p">(</span><span class="n">NSString</span><span class="o">*</span> <span class="n">str</span><span class="p">)</span>
<span class="p">{</span>
    <span class="n">NSMutableString</span><span class="o">*</span> <span class="n">codePoints</span> <span class="o">=</span> <span class="p">[</span><span class="n">NSMutableString</span> <span class="nf">string</span><span class="p">];</span>
    <span class="k">for</span><span class="p">(</span><span class="n">NSUInteger</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="p">[</span><span class="n">str</span> <span class="nf">length</span><span class="p">];</span> <span class="o">++</span><span class="n">i</span><span class="p">){</span>
        <span class="kt">long</span> <span class="n">ch</span> <span class="o">=</span> <span class="p">(</span><span class="kt">long</span><span class="p">)[</span><span class="n">str</span> <span class="nf">characterAtIndex</span><span class="p">:</span><span class="n">i</span><span class="p">];</span>
        <span class="p">[</span><span class="n">codePoints</span> <span class="nf">appendFormat</span><span class="p">:</span><span class="s">@"%0.4lX "</span><span class="p">,</span> <span class="n">ch</span><span class="p">];</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="n">codePoints</span><span class="p">;</span>
<span class="p">}</span>

<span class="n">NSLog</span><span class="p">(</span><span class="s">@"apples == %@"</span><span class="p">,</span> <span class="n">CodePoints</span><span class="p">(</span><span class="n">apples</span><span class="p">));</span>
<span class="c1">//apples == 0063 0061 0066 00E9</span>
<span class="n">NSLog</span><span class="p">(</span><span class="s">@"oranges == %@"</span><span class="p">,</span> <span class="n">CodePoints</span><span class="p">(</span><span class="n">oranges</span><span class="p">));</span>
<span class="c1">//oranges == 0063 0061 0066 0065 0301</span>
</code></pre></div></div>

<p>So they are, in fact, different strings.</p>

<p>If you were to look up the above Unicode characters (a.k.a code points) you
would find that:</p>

<ul>
  <li>
<code>0063</code> is ‘c’</li>
  <li>
<code>0061</code> is ‘a’</li>
  <li>
<code>0066</code> is ‘f’</li>
  <li>
<code>0065</code> is ‘e’</li>
  <li>
<code>00E9</code> is ‘é’ (LATIN SMALL LETTER E WITH ACUTE)</li>
  <li>
<code>0301</code> is ‘´’ (COMBINING ACUTE ACCENT)</li>
</ul>

<p>There are at least two ways to represent the glyph ‘é’ in Unicode. One way
is with the single code point <code>00E9</code>. The other is with two code points: an ‘e’
code point (<code>0065</code>) followed by a combining acute accent code point (<code>0301</code>).
Unicode sort of works like ASCII, but not quite.</p>

<p>This is where <a href="http://en.wikipedia.org/wiki/Unicode_normalization">Unicode normalization/equivalence</a> comes into play.
“Normalizing” a Unicode string simply involves taking all the glyphs that look
the same and giving them the same code point sequence. You can “compose” all
the glyphs, which will translate the two code points <code>0065</code> <code>0301</code>
into a single code point <code>00E9</code>. You can also “decompose” all the glyphs, which
will do the opposite. There are <a href="http://unicode.org/reports/tr15/">four types of Unicode normalization</a>, and
<code>NSString</code> provides methods for all of them:</p>

<ul>
  <li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/decomposedStringWithCanonicalMapping">decomposedStringWithCanonicalMapping</a></li>
  <li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/decomposedStringWithCompatibilityMapping">decomposedStringWithCompatibilityMapping</a></li>
  <li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/precomposedStringWithCanonicalMapping">precomposedStringWithCanonicalMapping</a></li>
  <li><a href="https://developer.apple.com/library/mac/documentation/Cocoa/Reference/Foundation/Classes/NSString_Class/Reference/NSString.html#//apple_ref/occ/instm/NSString/precomposedStringWithCompatibilityMapping">precomposedStringWithCompatibilityMapping</a></li>
</ul>

<p>Mad props to Simon for the tip.</p>

</div>

  <footer>
    <div class="tw-rounded-3xl tw-bg-pink-100 tw-p-8 tw-my-16 tw-text-center tw-bg-opacity-50">
      <p class="tw-text-2xl tw-uppercase tw-text-pink-900 tw-font-black tw-mb-4">Enjoy this?</p>

      <p class="tw-flex tw-flex-col sm:tw-flex-row tw-justify-center tw-item-center sm:tw-items-baseline">
        <a href="/feed/" class="tw-flex-1 tw-bg-pink-500 tw-py-3 tw-px-4 tw-rounded-lg tw-text-pink-100 tw-ring-2 tw-ring-pink-300 hover:tw-text-white">Subscribe via RSS</a>
        <span class="tw-flex-none tw-px-8 tw-py-4 tw-text-pink-800">or</span>
        <a href="https://twitter.com/tom_dalling" class="tw-flex-1 tw-bg-pink-500 tw-py-3 tw-px-4 tw-rounded-lg tw-text-pink-100 tw-ring-2 tw-ring-pink-300 hover:tw-text-white">Follow on Twitter</a>
      </p>

      <p class="tw-text-center tw-mt-4 tw-mb-0 tw-text-pink-900">
        <em>Found a mistake?</em> Pull requests are welcome on
        <a href="https://github.com/tomdalling/tomdalling.com/whatever">GitHub</a>.
      </p>
</div>

    


    
      <h2>Comments</h2>
      <div id="disqus_thread"></div>
      <script type="text/javascript" id="disqus_script">
        var disqus_shortname = "tomdalling";
        var disqus_identifier = "576 http://tomdalling.com/blog/?p=576";
        var disqus_title = "When A Café Is Not A Café – A Short Lesson In Unicode Featuring NSString";
        var disqus_url = "https://www.tomdalling.com/blog/coding-tips/when-a-cafe-is-not-a-cafe-a-short-lesson-in-unicode-featuring-nsstring/";

        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments.</a>
</noscript>
    

  </footer>
</article>
</main>

      <aside class="tw-px-4 tw-text-center lg:tw-text-left lg:tw-w-1/3 tw-flex-none">

        <div class="tw-text-lg tw-font-title tw-mb-1">Subscribe</div>
        <ul class="tw-space-y-2">
          <li>
            <a href="/blog/feed/">
              <i class="fa fa-rss"></i> RSS
            </a>
          </li>
          <li>
            <a href="https://twitter.com/tom_dalling">
              <i class="fa fa-twitter"></i> Twitter
            </a>
          </li>
        </ul>

        <div class="tw-text-lg tw-font-title tw-mb-1 tw-mt-6">Recent Posts</div>
        <ul class="recent-posts tw-space-y-2">
          
        <li><a href="/blog/testing/monologue-on-end-to-end-testing/">Monologue On End-To-End Testing</a></li>
<li><a href="/blog/mentoring/write-detailed-rspec-example-descriptions/">Write Detailed RSpec Example Descriptions</a></li>
<li><a href="/blog/mentoring/start-with-high-level-tests/">Start With High-Level Tests</a></li>
<li><a href="/blog/testing/the-tip-of-the-inputberg/">The Tip Of The Inputberg</a></li>
<li><a href="/blog/software-processes/better-user-stories/">Better User Stories</a></li>
</ul>

        <div class="tw-text-lg tw-font-title tw-mb-1 tw-mt-6">Categories</div>
        <ul class="categories tw-space-y-2">
          
        <li>
            <a href="/blog/cocoa/" class="category">Cocoa</a>
            (<span class="post-count">5</span>
            <a class="feed" href="/blog/cocoa/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/coding-styleconventions/" class="category">Coding Style/Conventions</a>
            (<span class="post-count">3</span>
            <a class="feed" href="/blog/coding-styleconventions/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/coding-tips/" class="category">Coding Tips</a>
            (<span class="post-count">4</span>
            <a class="feed" href="/blog/coding-tips/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/mentoring/" class="category">Mentoring Notes</a>
            (<span class="post-count">2</span>
            <a class="feed" href="/blog/mentoring/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/random-stuff/" class="category">Miscellaneous</a>
            (<span class="post-count">3</span>
            <a class="feed" href="/blog/random-stuff/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/modern-opengl/" class="category">Modern OpenGL Series</a>
            (<span class="post-count">10</span>
            <a class="feed" href="/blog/modern-opengl/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/ruby/" class="category">Ruby</a>
            (<span class="post-count">2</span>
            <a class="feed" href="/blog/ruby/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/software-design/" class="category">Software Design</a>
            (<span class="post-count">11</span>
            <a class="feed" href="/blog/software-design/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/software-processes/" class="category">Software Processes</a>
            (<span class="post-count">2</span>
            <a class="feed" href="/blog/software-processes/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/testing/" class="category">Testing</a>
            (<span class="post-count">2</span>
            <a class="feed" href="/blog/testing/feed/"><i class="fa fa-rss"></i></a>)
          </li>
<li>
            <a href="/blog/web/" class="category">Web</a>
            (<span class="post-count">1</span>
            <a class="feed" href="/blog/web/feed/"><i class="fa fa-rss"></i></a>)
          </li>
</ul>

        <div class="tw-text-lg tw-font-title tw-mb-1 tw-mt-6">Archives</div>
        <ul class="archives tw-space-y-2">
          
        <li>
            <a href="/blog/2021/" class="year">2021</a>
            (<span class="post-count">4</span>)
          </li>
<li>
            <a href="/blog/2020/" class="year">2020</a>
            (<span class="post-count">5</span>)
          </li>
<li>
            <a href="/blog/2016/" class="year">2016</a>
            (<span class="post-count">1</span>)
          </li>
<li>
            <a href="/blog/2015/" class="year">2015</a>
            (<span class="post-count">2</span>)
          </li>
<li>
            <a href="/blog/2014/" class="year">2014</a>
            (<span class="post-count">3</span>)
          </li>
<li>
            <a href="/blog/2013/" class="year">2013</a>
            (<span class="post-count">5</span>)
          </li>
<li>
            <a href="/blog/2012/" class="year">2012</a>
            (<span class="post-count">10</span>)
          </li>
<li>
            <a href="/blog/2011/" class="year">2011</a>
            (<span class="post-count">1</span>)
          </li>
<li>
            <a href="/blog/2010/" class="year">2010</a>
            (<span class="post-count">5</span>)
          </li>
<li>
            <a href="/blog/2009/" class="year">2009</a>
            (<span class="post-count">9</span>)
          </li>
</ul>

      </aside>

    </div>

    <footer class="page-footer">
      <p>© 2009 – <span class="current-year">2021</span> Tom Dalling</p>

      <p class="social">
        <a href="https://twitter.com/tom_dalling">
          <i class="fa fa-lg fa-twitter"></i>
        </a>
        <a href="https://github.com/tomdalling">
          <i class="fa fa-lg fa-github"></i>
        </a>
        <a href="https://stackoverflow.com/users/108105/tom-dalling">
          <i class="fa fa-lg fa-stack-overflow"></i>
        </a>
        <a href="mailto:tom%20at%20tomdalling%20com">
          <i class="fa fa-lg fa-envelope"></i>
        </a>
      </p>
    </footer>

    <script src="/bundles/all.js"></script>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [['$$','$$']],
          displayMath: [['[blockmath]', '[/blockmath]']]
        }
      });
    </script>
    <script type="text/javascript" async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>

  </body>
</html>
